
# 第四章 做算数（公式、变量和函数）

这一章，将指挥计算机做计算，逐渐熟悉编程。

## 4.1 写程序的地方

前回 `hello` 目录创建了第一个程序，之后既可以重复使用该目录，也可以新建一个别的目录。请按照您的喜好进行。如果要新建目录，请参考上一篇文章，在 VSCode 中打开并进行模块初始化。

## 4.2 示例程序的说明

下面的程序， `package main` 和 `import "fmt"` 等等，在不需要说明时会被省略，但实际上代码还是需要写的，请不要删除。

## 4.3 显示数字

要显示数字，请将 `()` 中的 `fmt.Println` 函数的内容设置为数字。

```go
package main

import "fmt"

func main() {
	fmt.Println(42)
}
$ go run .
42
```

## 4.4 计算式

在 Go 中，主要的算术字符如下所示。加法和减法大家很熟悉，但其他符号可能会让你感到惊讶。这些都是编程世界中常见的符号。此外，还有一个不太熟悉的“取余”计算，实际上在游戏中也经常使用。

```go
1 + 2 // 加法
1 - 2 // 剑减法
1 * 2 // 乘法
1 / 2 // 除法
1 % 2 // 割求余
```

这些计算，也有熟悉的优先顺序，乘法、除法和取余的优先级高于加法和减法。也可以使用括号 `()` 来改变优先顺序。

```go
func main() {
	fmt.Println(1 + 2*3) // 7
	fmt.Println((1 + 2) * 3) // 9
}
```

Go 提供了一种根据优先级等规则自动调整代码格式与间距的格式化功能（gofmt）。虽然无法设置自己喜欢的风格，但由于“任何人都可以轻松格式化成相同的样式，因此大家都能更容易阅读”，我们应该接受这一点。

##  4.5 小数计算

在 Go 中，整数和小数被明确区分，因此整数与整数的计算结果会去掉小数点后的部分，变为整数。例如 `1 / 2` 的结果是 `0` 。

```go
func main() {
	fmt.Println(1 / 2)
}
$ go run .
0
```

进行小数计算时，请明确指定为小数（也叫做浮点数），例如 `1.0` 。

```go
func main() {
	fmt.Println(1.0 / 2.0)
}
$ go run .
0.5
```

### [面向有经验的人] 浮动小数与字面量

字面量（包括 Go 中的常量）是一种与普通数值类型略有不同的类型 `untyped` ，在类型转换方面比普通类型宽松一些。此外，浮动小数点常量在编译时以任意精度（实际上由于实现上的原因为 256 位）进行计算，因此基本不需要担心误差等问题。



##  4.6 变量

使用变量可以为数据命名并保存起来（虽然是保存，但仅在程序运行期间可用，是临时的）。通过使用变量，可以多次使用相同的数据。以下是变量最简单的用法。

```go
package main

import "fmt"

func main() {
	level := 50
	fmt.Println(level)
}
$ go run .
50
```

成功地将值保存到名为 `level` 的变量中并显示出来。

### 声明与赋值

记号 `:=` 是变量的声明和赋值同时进行的记号。声明是数据的“新建”，赋值是数据的“覆盖”，这样理解会更好。为了更深入地理解，我们来看一下将声明和赋值分开的写法。

声明后赋值

```go
func main() {
	// 先做声明 
	var level int
	// 然后代入数值
	level = 50
	fmt.Println(level)
}
```

GO以 `var 参数名称 参数类型` 的形式声明变量，并以 `参数名 = 参数值` 的形式赋值。关于变量的类型稍后会解释，但 `int` 表示整数类型。

变量的声明（新建）只需一次，但赋值（覆盖）可以多次进行。

```go
func main() {
	var level int
	// var level int ←无法用同一个名字再次声明

	level = 50
	fmt.Println(level)
	level = 100
	fmt.Println(level)
}
```

### [面向有经验的人] 作用域

Go 变量（或者说所有标识符）具有作用域（有效范围）。作用域由块（ `{}` ）分隔。在作用域内声明的变量仅在该作用域内有效，无法从作用域外访问。

同名变量在严格意义上“在同一作用域内”不能再次声明，但在不同作用域中可以声明同名变量。在更小的作用域中声明同名变量会优先使用，因此原变量会被隐藏，在该作用域内无法访问。这被称为遮蔽。

不过，在大多数情况下，变量的声明和赋值是同时进行的。声明和赋值同时进行时，可以省略变量的类型，这也是一个优点。即使同时进行，之后仍然可以多次赋值，这一点没有改变。

```go
func main() {
	var level = 50 // 声明和赋值是同时进行，表示类型的 int 可以省略
	fmt.Println(level)
	level = 100 // 再次赋值
	fmt.Println(level)
}
```

此外，在函数内可以使用符号 `:=` 来省略 `var` ，使得声明和赋值更简洁，这也是最常用的语法。

在这里回到开头的记法

```go
func main() {
	level := 50 // 声明与赋值
	fmt.Println(level)
	level = 100 // 再次赋值
	fmt.Println(level)
}
```

## 4.7 变量和计算式

变量可以像普通数字一样混合在计算式中。

```go
func main() {
	level := 50
	waza := 100 // 盾甲龙兽
	attack := 182
	defense := 189

	maxDamage := level*2/5 + 2
	maxDamage = maxDamage*waza*attack/defense/50 + 2

	fmt.Println("最大伤害", maxDamage) // 最大伤害 44
}
```

此外，还有一种将计算和代入结合的省略形式。

```go
func main() {
	hp := 100
	hp += 20        // 与 hp = hp + 20 同义
	fmt.Println(hp) // 120
	hp -= 50        // 与 hp = hp - 50 同义
	fmt.Println(hp) // 70

	// *=, /=, %= 也是一样的规则
}
```

 * `hp = hp + 20` 等等在数学中，是不可能存在的式子，但在这里 `=` 仅仅是代入（覆盖）的符号，所以请把它当作不同的东西来看。如果实在无法适应，请在心中将 `=` 替换为 `⇐` 等等。

##  4.8 函数

函数是某种处理的集合。例如 `fmt.Println` 函数是执行在屏幕上显示文本的处理的函数。

函数可以接收 `()` 中的输入。这个输入称为参数。给函数提供输入称为传递参数（简称“传参”）。参数可以用逗号 `,` 分隔，同时传递多个。例如， `fmt.Println` 函数，就可以将多个参数用空格连接并显示在屏幕上。

```go
fmt.Println("哈哈", "呵呵")
$ go run .
哈哈 呵呵
```

函数不仅接受输入，还会输出计算或处理的结果。这被称为返回值。 `fmt.Println` 函数不返回返回值，因此我们引入另一个函数。 `max` 函数是一个返回参数中最大值的函数。

```go
func main() {
	fmt.Println(max(3, 4, 5)) // 5
}
```
这里的 `()` 有两层，可以简单地认为在 `max(3, 4, 5)` 的计算完成后，该部分将被替换为 `5` 。

```go
fmt.Println(max(3, 4, 5))
// max(3, 4, 5)的计算完成之后、↓将会等同于下面的式子
fmt.Println(5)
```

引数和返回值混在一起也是一样的。在这个程序中，我们来思考一下传递给 `fmt.Println` 函数多少个参数。

```go
func main() {
	fmt.Println("最大値は", max(3, 4, 5), "です。最小値は", min(3, 4, 5), "です。")
}
```

##  本章总结

- 虽然符号不一样，但在 Go 中也可以书写算式。
- 算式可以设置优先级，通过括号来控制。
- 使用变量可以命名数据，并临时保存数据。
- 通过传递参数和接收返回值，可以使用函数（处理块）。