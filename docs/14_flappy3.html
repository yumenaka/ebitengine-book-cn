<!DOCTYPE HTML>
<html lang="zh-Hans" class="rust" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>ç¬¬åå››ç«  é£å¤©åœ°é¼ æ¸¸æˆ ï¼ˆ3ï¼‰åœºæ™¯åˆ‡æ¢ - ä»é›¶å¼€å§‹çš„æ¸¸æˆç¼–ç¨‹ï¼šGo è¯­è¨€ä¸ Ebitengine</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="é¢å‘åˆå­¦è€…ï¼Œä»é›¶å¼€å§‹ä½œæ¸¸æˆçš„ Go è¯­è¨€ä¸ Ebitengine æ•™ç¨‹">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="theme/pagetoc.css">
        <link rel="stylesheet" href="./mdbook-admonish.css">

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "rust";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('rust')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="01_intro.html"><strong aria-hidden="true">1.</strong> ç¬¬ä¸€ç«  å…³äºè¿™æœ¬ä¹¦</a></li><li class="chapter-item expanded "><a href="02_setup.html"><strong aria-hidden="true">2.</strong> ç¬¬äºŒç«  å®‰è£…è½¯ä»¶ï¼Œé…ç½®ç¯å¢ƒ</a></li><li class="chapter-item expanded "><a href="03_hello-world.html"><strong aria-hidden="true">3.</strong> ç¬¬ä¸‰ç«  ä½ å¥½ï¼Œä¸–ç•Œï¼ï¼ˆå¼€å§‹å¼€å‘ï¼Œç¨‹åºç»“æ„ï¼‰</a></li><li class="chapter-item expanded "><a href="04_expr.html"><strong aria-hidden="true">4.</strong> ç¬¬å››ç«  åšç®—æ•°ï¼ˆå…¬å¼ã€å˜é‡å’Œå‡½æ•°ï¼‰</a></li><li class="chapter-item expanded "><a href="05_import.html"><strong aria-hidden="true">5.</strong> ç¬¬äº”ç«  æ˜¾ç¤ºéšæœºæ•°ï¼ˆåŒ…ä¸å¯¼å…¥ï¼‰</a></li><li class="chapter-item expanded "><a href="06_if.html"><strong aria-hidden="true">6.</strong> ç¬¬å…­ç«  ç©æŠ½ç­¾ï¼ˆæ¡ä»¶åˆ†æ”¯ï¼‰</a></li><li class="chapter-item expanded "><a href="07_for.html"><strong aria-hidden="true">7.</strong> ç¬¬ä¸ƒç«  åšçŒœæ•°å­—æ¸¸æˆï¼ˆforå¾ªç¯ï¼‰</a></li><li class="chapter-item expanded "><a href="08_window.html"><strong aria-hidden="true">8.</strong> ç¬¬å…«ç«  ç»˜åˆ¶çª—å£</a></li><li class="chapter-item expanded "><a href="09_frames.html"><strong aria-hidden="true">9.</strong> ç¬¬ä¹ç«  ç§»åŠ¨è§’è‰²ï¼ˆå¸§å’Œç›¸å…³æ¦‚å¿µï¼‰</a></li><li class="chapter-item expanded "><a href="10_float.html"><strong aria-hidden="true">10.</strong> ç¬¬åç«  è®©è§’è‰²è·³å¾—è‡ªç„¶ï¼ˆæµ®ç‚¹æ•°å’Œç±»å‹ï¼‰</a></li><li class="chapter-item expanded "><a href="11_slice.html"><strong aria-hidden="true">11.</strong> ç¬¬åä¸€ç«  åŠ å¿«åŠ¨ä½œï¼ˆåˆ‡ç‰‡ä¸å¾ªç¯ï¼‰</a></li><li class="chapter-item expanded "><a href="12_flappy1.html"><strong aria-hidden="true">12.</strong> ç¬¬åäºŒç«  é£å¤©åœ°é¼ æ¸¸æˆ ï¼ˆ1ï¼‰ä¼šåŠ¨çš„å¢™</a></li><li class="chapter-item expanded "><a href="13_flappy2.html"><strong aria-hidden="true">13.</strong> ç¬¬åä¸‰ç«  é£å¤©åœ°é¼ æ¸¸æˆ ï¼ˆ2ï¼‰ç¢°æ’æ£€æµ‹</a></li><li class="chapter-item expanded "><a href="14_flappy3.html" class="active"><strong aria-hidden="true">14.</strong> ç¬¬åå››ç«  é£å¤©åœ°é¼ æ¸¸æˆ ï¼ˆ3ï¼‰åœºæ™¯åˆ‡æ¢</a></li><li class="chapter-item expanded "><a href="15_build.html"><strong aria-hidden="true">15.</strong> ç¬¬åäº”ç«  å‘å¸ƒæ¸¸æˆè®©æœ‹å‹ç©ï¼ˆæ„å»ºå’Œåˆ†å‘ï¼‰</a></li><li class="chapter-item expanded "><a href="16_struct.html"><strong aria-hidden="true">16.</strong> ç¬¬åå…­ç«  æŠŠæ•°æ®æ”¾åœ¨ä¸€èµ·ï¼ˆç»“æ„ä½“ï¼‰</a></li><li class="chapter-item expanded "><a href="17_funcdecl.html"><strong aria-hidden="true">17.</strong> ç¬¬åä¸ƒç«  æŠŠå¤„ç†æ”¾åœ¨ä¸€èµ·ï¼ˆå‡½æ•°å£°æ˜ï¼‰</a></li><li class="chapter-item expanded "><a href="18_pointer.html"><strong aria-hidden="true">18.</strong> ç¬¬åå…«ç«  æŒ‡é’ˆï¼ˆPointerï¼‰</a></li><li class="chapter-item expanded "><a href="19_method.html"><strong aria-hidden="true">19.</strong> ç¬¬åä¹ç«  å°†å‡½æ•°ç»‘å®šåˆ°ç±»å‹ï¼ˆmethodï¼‰</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">ä»é›¶å¼€å§‹çš„æ¸¸æˆç¼–ç¨‹ï¼šGo è¯­è¨€ä¸ Ebitengine</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/yumenaka/ebitengine-book-cn" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/yumenaka/ebitengine-book-cn/edit/main/src/14_flappy3.md" title="Suggest an edit" aria-label="Suggest an edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <div class="content-wrap">
                            <h1 id="ç¬¬åå››ç« -é£å¤©åœ°é¼ æ¸¸æˆ-3åœºæ™¯åˆ‡æ¢"><a class="header" href="#ç¬¬åå››ç« -é£å¤©åœ°é¼ æ¸¸æˆ-3åœºæ™¯åˆ‡æ¢">ç¬¬åå››ç«  é£å¤©åœ°é¼ æ¸¸æˆ ï¼ˆ3ï¼‰åœºæ™¯åˆ‡æ¢</a></h1>
<p>å‰é¢çš„å†…å®¹é‡Œï¼Œå·²ç»å®ç°äº†åˆ¤å®šå’Œè®¡åˆ†ï¼Œæ¸¸æˆçš„æ ¸å¿ƒéƒ¨åˆ†å®Œæˆäº†ã€‚è¿™æ¬¡ï¼Œæˆ‘ä»¬å°†æ„å»ºè¢«ç§°ä¸ºåœºæ™¯åˆ‡æ¢çš„å¤–éƒ¨åŠŸèƒ½ã€‚</p>
<h2 id="åœºæ™¯åˆ‡æ¢"><a class="header" href="#åœºæ™¯åˆ‡æ¢">åœºæ™¯åˆ‡æ¢</a></h2>
<p>å‰å›æˆ‘ä»¬å®ç°äº†ç¢°æ’åˆ¤å®šï¼Œä½†æ˜¾ç„¶è¿˜æ²¡æœ‰å®ç°æ¸¸æˆç»“æŸçš„å¤„ç†ã€‚æ­¤å¤–ï¼Œæ¸¸æˆå¯åŠ¨åç›´æ¥å¼€å§‹ä¹Ÿä¸å¤ªå‹å¥½ï¼Œæ˜¾å¾—æœ‰äº›å†·æ¸…ã€‚æ ‡é¢˜ç”»é¢ä¹Ÿæ˜¯å¿…è¦çš„ã€‚å°†å±å¹•åˆ‡æ¢ä¸ºå¦ä¸€ä¸ªçŠ¶æ€çš„å¤„ç†ï¼Œè¢«ç§°ä¸º<strong>å±å¹•åˆ‡æ¢æˆ–åœºæ™¯åˆ‡æ¢</strong>ã€‚</p>
<h3 id="è®¾è®¡ç”»é¢"><a class="header" href="#è®¾è®¡ç”»é¢">è®¾è®¡ç”»é¢</a></h3>
<p>åœ¨å®ç°ç”»é¢è¿ç§»ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆè€ƒè™‘ä¸€ä¸‹éœ€è¦å“ªäº›ç”»é¢ã€‚è¿™æ¬¡æˆ‘ä»¬å°†åˆ¶ä½œä»¥ä¸‹ä¸‰ä¸ªç”»é¢ã€‚</p>
<ul>
<li>æ ‡é¢˜ç”»é¢ã€‚ç‚¹å‡»åæ¸¸æˆå¼€å§‹ã€‚</li>
<li>æ¸¸æˆç”»é¢ã€‚æ’åˆ°åœŸç®¡å°±ä¼šæ¸¸æˆç»“æŸã€‚</li>
<li>æ¸¸æˆç»“æŸç”»é¢ã€‚æ˜¾ç¤ºåˆ†æ•°ï¼Œç‚¹å‡»åè¿”å›æ ‡é¢˜ç”»é¢ã€‚</li>
</ul>
<h3 id="è€ƒè™‘éª¨æ¶ç»“æ„"><a class="header" href="#è€ƒè™‘éª¨æ¶ç»“æ„">è€ƒè™‘éª¨æ¶ç»“æ„</a></h3>
<p>ç”»é¢è¿ç§»è™½ç„¶å¬èµ·æ¥å¤æ‚ï¼Œä½†æœ¬è´¨ä¸Šåªæ˜¯ä¸€ä¸ª switch è¯­å¥ã€‚éª¨æ¶å¤§è‡´æ˜¯è¿™æ ·çš„ï¼Œæ ¹æ®è¡¨ç¤ºç”»é¢çš„å˜é‡ <code>scene</code> æ¥åˆ†æ”¯å¤„ç†è¯¥å¸§çš„æ“ä½œã€‚ <code>scene</code> æ˜¯åœ¨æ»¡è¶³ä¸‹ä¸€ä¸ªç”»é¢è¿ç§»æ¡ä»¶æ—¶ä¼šè¢«æ›´æ”¹çš„ä¸œè¥¿ã€‚åè¿‡æ¥è¯´ï¼Œåœ¨ä¸æ»¡è¶³è¿ç§»æ¡ä»¶çš„æƒ…å†µä¸‹ï¼Œå§‹ç»ˆä¿æŒç›¸åŒçš„ <code>scene</code> ã€‚</p>
<pre><code class="language-go">var scene = "title" // ä¿å­˜å½“å‰ç”»é¢çš„å˜é‡

func draw() {
	switch scene {
	case "title":
		// æ ‡é¢˜ç”»é¢çš„å¤„ç†
		// ç‚¹å‡»ä¹‹åè®© scene = "game" 

	case "game":
		// æ¸¸æˆç”»é¢çš„å¤„ç†
		// æ’ä¸ŠåœŸç®¡ä¹‹åè®© scene = "gameover" 

	case "gameover":
		// æ¸¸æˆç»“æŸç”»é¢çš„å¤„ç†
		// ç‚¹å‡»ä¹‹åè®© scene = "title"  
	}
}
</code></pre>
<p>è¿™æ ·è™½ç„¶ç®€å•ï¼Œä½†å¦‚æœå°†ä¹‹å‰å®ç°çš„ draw å‡½æ•°çš„å†…å®¹ç§»åˆ° <code>case "game":</code> ä¸‹é¢ï¼Œå°±ä¼šå˜å¾—éå¸¸éš¾ä»¥é˜…è¯»ã€‚</p>
<pre><code class="language-go">	case "game":
		// è®¡ç®—å¾—åˆ† 
		// ç‚¹å‡»åè·³è·ƒ
		// è¿½åŠ åœŸç®¡
		// ç§»åŠ¨åœŸç®¡
		// å£æç»˜åœŸç®¡
		// ç©åœ°é¼ ä¸åœŸç®¡çš„ç¢°æ’åˆ¤å®š
		// å¤©èŠ±æ¿ï¼Œåœ°æ¿çš„ç¢°æ’åˆ¤å®š
		// ...
</code></pre>
<p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé€šè¿‡è‡ªå·±åˆ›å»ºå‡½æ•°ï¼ˆå¤„ç†çš„é›†åˆï¼‰æ¥æ•´ç†ä»£ç å§ã€‚ä½¿ç”¨å‡½æ•°æ—¶ï¼Œswitch è¯­å¥å¯èƒ½ä¼šæ˜¯è¿™æ ·çš„ã€‚</p>
<pre><code class="language-go">func draw() {
	switch scene {
	case "title":
		drawTitle()

	case "game":
		drawGame()

	case "gameover":
		drawGameover()
	}
}

func drawTitle() {
	// æ ‡é¢˜ç”»é¢çš„å¤„ç†
}

func drawGame() {
	// å‰å›ã¾ã§ã®drawé–¢æ•°ã¨åŒã˜
	// è®¡ç®—å¾—åˆ†
	// ç‚¹ç”»é¢è·³è·ƒ
	// ...
}

func drawGameover() {
	// æ¸¸æˆç»“æŸçš„å¤„ç†
}
</code></pre>
<p>åæ˜ åˆ°å®é™…çš„ç¨‹åºä¸­ï¼š</p>
<pre><code class="language-diff-go">package main

import (
	"math/rand/v2"

	"github.com/eihigh/miniten"
)

var (
	x    = 200.0
	y    = 150.0
	vy   = 0.0  // Yæ–¹å‘é€Ÿåº¦(Velocity of y)çš„ç¼©å†™
	g    = 0.1  // é‡åŠ›åŠ é€Ÿåº¦(Gravity) çš„ç¼©å†™
	jump = -4.0 // è·³è·ƒåŠ›

	frames     = 0       // ç»è¿‡çš„å¸§æ€»æ•°
	interval   = 120     // å¢™çš„è¿½åŠ é—´éš”
	wallStartX = 640     // å¢™çš„åˆå§‹åŒ–xåæ ‡
	wallXs     = []int{} // å¢™çš„xåæ ‡
	wallWidth  = 20      // å¢™çš„å®½åº¦
	wallHeight = 360     // å¢™çš„é«˜åº¦
	holeYs     = []int{} // ç©ºæ´çš„yåæ ‡
	holeYMax   = 150     // ç©ºæ´çš„yåæ ‡çš„æœ€å¤§å€¼
	holeHeight = 170     // ç©ºæ´çš„å¤§å°ï¼ˆé«˜åº¦ï¼‰

	gopherWidth  = 60
	gopherHeight = 75

	scene = "title"
)

func main() {
	miniten.Run(draw)
}

func draw() {
	switch scene {
	case "title":
		drawTitle()

	case "game":
		drawGame()

	case "gameover":
		drawGameover()
	}
}

func drawTitle() {
}

func drawGame() {
	// å’Œä¸Šä¸€ç« çš„ drawGame() å‡½æ•°å®Œå…¨ä¸€æ ·ï¼Œæ‰€ä»¥è¿™é‡Œçœç•¥äº†ä»£ç 
}

func drawGameover() {
}
</code></pre>
<p>æ‰§è¡Œæ­¤æ“ä½œæ—¶ï¼Œ <code>drawTitle</code> çš„å¤„ç†ä¸ºç©ºï¼Œå› æ­¤ä¸ä¼šå‘ç”Ÿä»»ä½•äº‹æƒ…ã€‚è®©æˆ‘ä»¬åˆ¶ä½œæ ‡é¢˜ç”»é¢ã€‚</p>
<p>èƒŒæ™¯å’Œâ€œç‚¹å‡»å¼€å§‹â€çš„æç¤ºï¼ŒåŒæ—¶æ˜¾ç¤º gopher å›ã€‚å¦‚æœå¤§å®¶èƒ½è·Ÿåˆ°è¿™é‡Œï¼Œç†è§£è¿™ä¸ªåº”è¯¥æ²¡é—®é¢˜å§ã€‚</p>
<pre><code class="language-go">func drawTitle() {
	miniten.DrawImage("sky.png", 0, 0)
	miniten.Println("ç‚¹å‡»åå¼€å§‹")
	miniten.DrawImage("gopher.png", int(x), int(y))
	if miniten.IsClicked() {
		scene = "game"
	}
}
</code></pre>
<p>è¿™ä¸‹ç‚¹å‡»åå°±å¯ä»¥å¼€å§‹æ¸¸æˆäº†ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°†åˆ¶ä½œæ¸¸æˆç»“æŸç”»é¢ã€‚</p>
<p>ä¹‹å‰çš„ä»£ç ï¼Œå¦‚æœæ»¡è¶³äº†ç¢°æ’åˆ¤å®šçš„æ¡ä»¶ï¼Œåªä¼šåœ¨é¡µé¢çš„å·¦ä¸Šè§’æ˜¾ç¤ºæ¸¸æˆç»“æŸçš„æ–‡å­—æç¤ºã€‚</p>
<p>æ­¤æ¬¡ä¸ºäº†åˆ‡æ¢ç”»é¢æ¸¸æˆç»“æŸç”»é¢ï¼Œ ä¼šè®©<code>scene = "gameover"</code> ` ï¼Œæ˜¾ç¤ºä¸“é—¨çš„æ¸¸æˆç»“æŸç”»é¢ã€‚</p>
<p>åœ¨ drawGameover å‡½æ•°ä¸­ï¼Œæ˜¾ç¤ºæ¸¸æˆç»“æŸçš„æ¶ˆæ¯å’Œæœ€åçš„åˆ†æ•°ã€‚ç”±äºåˆ†æ•°ä»ç„¶æ˜¯å±€éƒ¨å˜é‡ï¼Œå› æ­¤æ— æ³•åœ¨ drawGameover å‡½æ•°ä¸­ä½¿ç”¨ï¼Œæ‰€ä»¥éœ€è¦å°†å…¶æ”¹ä¸ºå…¨å±€å˜é‡ã€‚</p>
<p>å°†ä»¥ä¸Šä¸¤ä¸ªå˜æ›´ï¼Œåæ˜ åˆ°å®é™…çš„ç¨‹åºä¸­ã€‚</p>
<p>!å‰Šé™¤éƒ¨åˆ†ä¸ºçº¢è‰²ï¼ˆTODOï¼‰ã€‚</p>
<pre><code class="language-diff-go">package main

import (
	"math/rand/v2"

	"github.com/eihigh/miniten"
)

var (
	x    = 200.0
	y    = 150.0
	vy   = 0.0  // Yæ–¹å‘é€Ÿåº¦(Velocity of y)çš„ç¼©å†™
	g    = 0.1  // é‡åŠ›åŠ é€Ÿåº¦(Gravity) çš„ç¼©å†™
	jump = -4.0 // è·³è·ƒåŠ›

	frames     = 0       // ç»è¿‡çš„å¸§æ€»æ•°
	interval   = 120     // å¢™çš„è¿½åŠ é—´éš”
	wallStartX = 640     // å¢™çš„åˆå§‹åŒ–xåæ ‡
	wallXs     = []int{} // å¢™çš„xåæ ‡
	wallWidth  = 20      // å¢™çš„å®½åº¦
	wallHeight = 360     // å¢™çš„é«˜åº¦
	holeYs     = []int{} // ç©ºæ´çš„yåæ ‡
	holeYMax   = 150     // ç©ºæ´çš„yåæ ‡çš„æœ€å¤§å€¼
	holeHeight = 170     // ç©ºæ´çš„å¤§å°ï¼ˆé«˜åº¦ï¼‰

	gopherWidth  = 60
	gopherHeight = 75

	scene = "title"
	score = 0 // åˆ†æ•°æ˜¯å…¨å±€å˜é‡
)

func main() {
	miniten.Run(draw)
}

func draw() {
	switch scene {
	case "title":
		drawTitle()

	case "game":
		drawGame()

	case "gameover":
		drawGameover()
	}
}

func drawTitle() {
	miniten.DrawImage("sky.png", 0, 0)
	miniten.Println("ç‚¹å‡»å¼€å§‹æ¸¸æˆ")
	miniten.DrawImage("gopher.png", int(x), int(y))
	if miniten.IsClicked() {
		scene = "game"
	}
}

func drawGame() {
	miniten.DrawImage("sky.png", 0, 0)
	// score := 0 // åˆ é™¤è¿™é‡Œ
	for i, wallX := range wallXs {
		if wallX &lt; int(x) {
			score = i + 1
		}
	}
	miniten.Println("Score", score)
	if miniten.IsClicked() {
		vy = jump
	}
	vy += g // æ–°çš„å½“å‰é€Ÿåº¦ = å½“å‰é€Ÿåº¦+åŠ é€Ÿåº¦
	y += vy // æ–°çš„å½“å‰ä½ç½® = å½“å‰ä½ç½®+é€Ÿåº¦
	miniten.DrawImage("gopher.png", int(x), int(y))

	// ä»è¿™é‡Œå¼€å§‹ï¼Œå†™è¿½åŠ åœŸç®¡çš„ä»£ç 
	frames += 1
	if frames%interval == 0 {
		wallXs = append(wallXs, wallStartX)
		holeYs = append(holeYs, rand.N(holeYMax))
	}
	// è¿½åŠ åœŸç®¡çš„ä»£ç ï¼Œåˆ°è¿™é‡Œå°±ç»“æŸäº†

	for i := range wallXs {
		wallXs[i] -= 2 // å¾€å·¦åŠ¨
	}
	for i := range wallXs {
		// æç»˜ä¸Šé¢çš„åœŸç®¡
		wallX := wallXs[i]
		holeY := holeYs[i]
		miniten.DrawImage("wall.png", wallX, holeY-wallHeight)

		// æç»˜ä¸‹é¢çš„åœŸç®¡
		miniten.DrawImage("wall.png", wallX, holeY+holeHeight)

		// åˆ¶ä½œè¡¨ç¤ºåœ°é¼ çš„çŸ©å½¢
		aLeft := int(x)
		aTop := int(y)
		aRight := int(x) + gopherWidth
		aBottom := int(y) + gopherHeight

		// å®šä¹‰è¡¨ç¤ºä¸Šé¢åœŸç®¡çš„çŸ©å½¢ 
		bLeft := wallX
		bTop := holeY - wallHeight
		bRight := wallX + wallWidth
		bBottom := holeY

		// ä¸Šé¢çš„åœŸç®¡çš„åˆ¤å®š
		if aLeft &lt; bRight &amp;&amp;
			bLeft &lt; aRight &amp;&amp;
			aTop &lt; bBottom &amp;&amp;
			bTop &lt; aBottom {
			scene = "gameover"
		}

		// å®šä¹‰è¡¨ç¤ºä¸‹é¢åœŸç®¡çš„çŸ©å½¢
		bLeft = wallX
		bTop = holeY + holeHeight
		bRight = wallX + wallWidth
		bBottom = holeY + holeHeight + wallHeight

		// åœ°é¼ ä¸ä¸‹é¢çš„åœŸç®¡çš„ç¢°æ’åˆ¤å®š
		if aLeft &lt; bRight &amp;&amp;
			bLeft &lt; aRight &amp;&amp;
			aTop &lt; bBottom &amp;&amp;
			bTop &lt; aBottom {
			scene = "gameover"
		}
	}

	if y &lt; 0 {
		scene = "gameover"
	}
	if 360 &lt; y {
		scene = "gameover"
	}
}

func drawGameover() {
	// å°†èƒŒæ™¯ã€åœ°é¼ ã€åœŸç®¡çš„drawGameå‡½æ•°ç²˜è´´åˆ°è¿™é‡Œ
	miniten.DrawImage("sky.png", 0, 0)
	miniten.DrawImage("gopher.png", int(x), int(y))
	for i := range wallXs {
		// æç»˜ä¸Šé¢çš„åœŸç®¡
		wallX := wallXs[i]
		holeY := holeYs[i]
		miniten.DrawImage("wall.png", wallX, holeY-wallHeight)

		// æç»˜ä¸‹é¢çš„åœŸç®¡
		miniten.DrawImage("wall.png", wallX, holeY+holeHeight)
	}

	miniten.Println("Game Over")
	miniten.Println("Score", score)
}
</code></pre>
<p>è¿™ä¸‹ï¼Œæˆ‘ä»¬å·²ç»å®Œæˆäº†æ¸¸æˆç»“æŸç”»é¢çš„ç»˜åˆ¶ã€‚</p>
<p><img src="14_flappy3.assets/gameover.jpeg" alt="gameover.jpeg" /></p>
<p>ç„¶ååŒæ ·åœ¨æ¸¸æˆç»“æŸç”»é¢ç‚¹å‡»åä¼šæ˜¾ç¤º <code>scene = "title"</code> å°±ç»“æŸäº†â€¦â€¦æœ¬æ¥æƒ³è¿™ä¹ˆè¯´ï¼Œä½†é—æ†¾çš„æ˜¯è¿™å¹¶ä¸å¥æ•ˆã€‚</p>
<ul>
<li>æ¸¸æˆç»“æŸç”»é¢å¦‚æœ <code>miniten.IsClicked()</code> ä¸º trueï¼Œåˆ™å˜ä¸º <code>scene = "title"</code></li>
<li>åœ¨ä¸‹ä¸€ä¸ªå¸§ä¸­è¿›è¡Œæ˜¾ç¤ºæ ‡é¢˜ç”»é¢çš„å¤„ç†</li>
<li>åœ¨ä¸‹ä¸€ä¸ªå¸§ä¸­ï¼ˆé™¤éåœ¨ä¸€ä¸ªå¸§å†…ç¬é—´æ”¾å¼€æ‰‹æŒ‡ï¼‰ï¼Œ <code>miniten.IsClicked()</code> å°†å†æ¬¡å˜ä¸º true</li>
<li>å› æ­¤æ¸¸æˆç»“æŸçš„æ ‡é¢˜ç”»é¢ç¬é—´è¢«è·³è¿‡ï¼Œæ¸¸æˆå†æ¬¡å¼€å§‹</li>
</ul>
<p>å› æ­¤ï¼Œéœ€è¦å†™ä¸€ç§åˆ¤æ–­â€œç©å®¶æ²¡æœ‰æŒç»­æŒ‰ä¸‹æŒ‰é’®ï¼ŒåªæŒ‰ä¸‹äº†ä¸€ç¬é—´â€çš„æ–¹æ³•ï¼Œä»¥åŠé‡ç½®æ¸¸æˆçŠ¶æ€çš„å¤„ç†ã€‚</p>
<h2 id="åˆšå¥½è¢«æŒ‰ä¸‹çš„åˆ¤å®š"><a class="header" href="#åˆšå¥½è¢«æŒ‰ä¸‹çš„åˆ¤å®š">åˆšå¥½è¢«æŒ‰ä¸‹çš„åˆ¤å®š</a></h2>
<p>è¦åˆ¤æ–­æŒ‰é’®æ²¡æœ‰æŒç»­æŒ‰ä¸‹ï¼Œè€Œåªæ˜¯æŒ‰ä¸‹ä¸€ç¬é—´ï¼Œå¯ä»¥åˆ¤æ–­å‰ä¸€å¸§æ²¡æœ‰è¢«æŒ‰ä¸‹ï¼ŒåŒæ—¶å½“å‰å¸§è¢«æŒ‰ä¸‹äº†å³å¯ã€‚è¿™ä¸ªå¤„ç†åœ¨ä»»ä½•ç”»é¢ä¸­éƒ½å¾ˆæ–¹ä¾¿ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥æŠŠå®ƒå†™åœ¨ draw å‡½æ•°çš„å¼€å¤´ã€‚prev æ˜¯ previousï¼ˆå‰ä¸€ä¸ªï¼‰çš„ç¼©å†™ã€‚</p>
<p><code>!</code> è¡¨ç¤ºå¦å®š/notï¼Œ <code>!true</code> ç­‰äº <code>false</code> ï¼Œ <code>!false</code> ç­‰äº <code>true</code> ã€‚</p>
<pre><code class="language-diff-go">package main

import (
	"math/rand/v2"

	"github.com/eihigh/miniten"
)

var (
	// ...ä¸­ç•¥...
	scene = "title"
	score = 0

	isPrevClicked = false // å‰ä¸€å¸§æŒ‰é’®æ²¡æŒ‰ä¸‹
	isJustClicked = false // è¿™ä¸€å¸§æŒ‰é’®è¢«æŒ‰ä¸‹
)

func main() {
	miniten.Run(draw)
}

func draw() {
	// è¿™ä¸€å¸§æŒ‰é’®æ˜¯å¦è¢«æŒ‰ä¸‹ = å‰ä¸€å¸§æŒ‰é’®æ²¡æŒ‰ä¸‹ã€åŒæ—¶è¿™ä¸€å¸§æŒ‰é’®è¢«æŒ‰ä¸‹
	isJustClicked = miniten.IsClicked() &amp;&amp; !isPrevClicked
	// ä¸ºäº†ä¸‹ä¸€å¸§åšåˆ¤æ–­ã€ä¿å­˜â€œè¿™ä¸€å¸§æŒ‰é’®è¢«æŒ‰ä¸‹â€è¿™ä¸ªçŠ¶æ€
	isPrevClicked = miniten.IsClicked()

	switch scene {
	case "title":
	// ...åç•¥...
</code></pre>
<p>å°†è¿™ä¸ª <code>isJustClicked</code> ç”¨äºæ¸¸æˆç»“æŸç”»é¢å’Œæ ‡é¢˜ç”»é¢ã€‚</p>
<pre><code class="language-diff-go">func drawTitle() {
	miniten.DrawImage("sky.png", 0, 0)
	miniten.Println("ç‚¹å‡»å¼€å§‹æ¸¸æˆ")
	miniten.DrawImage("gopher.png", int(x), int(y))
	if isJustClicked {
		scene = "game"
	}
}

// ...ä¸­ç•¥...

func drawGameover() {
	// å°†èƒŒæ™¯ã€åœ°é¼ ã€åœŸç®¡çš„drawGameå‡½æ•°ç²˜è´´åˆ°è¿™é‡Œ
	miniten.DrawImage("sky.png", 0, 0)
	miniten.DrawImage("gopher.png", int(x), int(y))
	for i := range wallXs {
		// æç»˜ä¸Šé¢çš„åœŸç®¡
		wallX := wallXs[i]
		holeY := holeYs[i]
		miniten.DrawImage("wall.png", wallX, holeY-wallHeight)

		// æç»˜ä¸‹é¢çš„åœŸç®¡
		miniten.DrawImage("wall.png", wallX, holeY+holeHeight)
	}

	miniten.Println("Game Over")
	miniten.Println("Score", score)
	if isJustClicked {
		scene = "title"
	}
}
</code></pre>
<p>è¿™ä¸‹å¯ä»¥å®‰å…¨åœ°æŒ‰ä½è€Œä¸ä¼šè¢«è·³è¿‡äº†ã€‚</p>
<h2 id="æ¸¸æˆç»“æŸæ—¶çš„é‡ç½®"><a class="header" href="#æ¸¸æˆç»“æŸæ—¶çš„é‡ç½®">æ¸¸æˆç»“æŸæ—¶çš„é‡ç½®</a></h2>
<p>æ¥ä¸‹æ¥åªéœ€é‡ç½®æ¸¸æˆçŠ¶æ€ï¼Œä»¥ä¾¿ä»å¤´å¼€å§‹é‡æ–°æ¸¸ç©ã€‚gopher å›å’ŒåœŸç®¡çš„çŠ¶æ€å°†åœ¨æ¸¸æˆç»“æŸç”»é¢ä¸­ä¿æŒä»¥ä¾¿ç»˜åˆ¶ï¼Œå¹¶å¸Œæœ›åœ¨è¿”å›æ ‡é¢˜ç”»é¢çš„ç¬é—´é‡ç½®ï¼Œå› æ­¤å°†åœ¨ <code>if isJustClicked</code> ä¸­ç¼–å†™é‡ç½®å¤„ç†ã€‚</p>
<pre><code class="language-diff-go">	if isJustClicked {
		scene = "title"

		x = 200.0
		y = 150.0
		vy = 0.0
		frames = 0
		wallXs = []int{}
		holeYs = []int{}
		score = 0
	}
</code></pre>
<p>è¿™ä¸‹å¯ä»¥å…¨é¢ä½“éªŒæ¸¸æˆäº†ã€‚è¾›è‹¦äº†ï¼ãŠ—ï¸ğŸŠğŸ’¯ğŸ’¯</p>
<h2 id="æ›´å¤šçš„ç£¨ç»ƒ"><a class="header" href="#æ›´å¤šçš„ç£¨ç»ƒ">æ›´å¤šçš„ç£¨ç»ƒ</a></h2>
<p>å› æ­¤ï¼Œæœ¬ä¹¦ä¸­åˆ¶ä½œçš„ flappy æ¸¸æˆæš‚æ—¶å®Œæˆï¼Œä½†ä»ç„¶æœ‰è¿›ä¸€æ­¥æ‰“ç£¨çš„ç©ºé—´ã€‚å³ä½¿ä¸åŠ æ–°åŠŸèƒ½ï¼Œä¹Ÿå¯ä»¥</p>
<ul>
<li>è®©ç©å®¶è§’è‰²åŠ¨èµ·æ¥</li>
<li>åˆ©ç”¨æ»šåŠ¨æ•ˆæœç²¾å¿ƒè®¾è®¡èƒŒæ™¯ã€‚</li>
<li>å°†ç¢°æ’åˆ¤å®šçš„å¤§å°ç¼©å°ä»¥æå‡èˆ’é€‚æ„Ÿã€‚</li>
<li>éšç€è¿›ç¨‹çš„æ¨è¿›ï¼Œé€æ¸æ”¹å˜æ´å£çš„é«˜åº¦ã€å®½åº¦å’Œç§»åŠ¨é€Ÿåº¦ç­‰ï¼Œå¢åŠ éš¾åº¦ã€‚</li>
</ul>
<p>å¯ä»¥è€ƒè™‘è¿™æ ·çš„æ‰“ç£¨æ–¹å¼ï¼Œå¦‚æœä¹‹åå…¥é—¨ Ebitengineï¼Œ</p>
<ul>
<li>æ—‹è½¬ç©å®¶è§’è‰²ç­‰ã€‚</li>
<li>ç¢°åˆ°åœŸç®¡æ—¶å‘å‡ºå£°éŸ³ã€‚</li>
<li>æ›´æ”¹æ˜¾ç¤ºåˆ†æ•°çš„ä½ç½®ã€‚</li>
<li>æ·»åŠ æ¸¸æˆç»“æŸçš„æ¼”å‡ºã€‚</li>
</ul>
<p>ç­‰ç­‰ï¼Œæœ‰æ— æ•°çš„äº‹æƒ…å¯ä»¥åšã€‚å³ä½¿åœ¨ç¨‹åºä¸Šå¹¶ä¸å›°éš¾å®ç°ï¼Œä¹Ÿæœ‰å¾ˆå¤šæ½œåœ¨çš„ä¼˜åŒ–ç‚¹å¯ä»¥å¤§å¤§æå‡è¶£å‘³æ€§ï¼Œæ‰€ä»¥è¯·ä¸è¦æ»¡è¶³äºæ­¤ï¼Œè¿½æ±‚å±äºä½ è‡ªå·±çš„åŸåˆ›æ¸¸æˆå§ã€‚</p>
<h2 id="æ‰©å±•"><a class="header" href="#æ‰©å±•">æ‰©å±•</a></h2>
<p>è¿™æ¬¡åˆ¶ä½œçš„è·³è·ƒ gopher å›æ¸¸æˆåŒ…å«äº†è·³è·ƒçš„è¡Œä¸ºå’Œç¢°æ’åˆ¤å®šï¼Œå¯ä»¥è¯´æ˜¯åŠ¨ä½œæ¸¸æˆï¼ˆæ²™ç›’æ¸¸æˆ/å¹³å°æ¸¸æˆï¼‰çš„åŸºç¡€ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯ï¼Œå½“ç¢°åˆ°åœ°å½¢æ—¶æ˜¯æ¸¸æˆç»“æŸè¿˜æ˜¯å¯ä»¥ç«™åœ¨åœ°å½¢ä¸Šã€‚æ‰€æœ‰çš„ä¸€åˆ‡éƒ½æ˜¯ç›¸äº’å…³è”çš„å‘¢ï½ã€‚åœ¨æœ¬ä¹¦ä¸­ç¨åä¼šå®é™…å°è¯•åˆ¶ä½œåŠ¨ä½œæ¸¸æˆï¼ˆå¯èƒ½ã€‚è®¡åˆ’ä¸­ï¼‰ã€‚</p>
<h2 id="æœ¬ç« æ€»ç»“"><a class="header" href="#æœ¬ç« æ€»ç»“">æœ¬ç« æ€»ç»“</a></h2>
<p>é€šè¿‡ç”»é¢è¿ç§»ï¼Œæˆ‘ä»¬æ•´ç†äº†æ•´ä¸ªç¨‹åºçš„æµç¨‹ï¼Œå­¦ä¹ äº†æ„å»ºæ¸¸æˆçš„æµç¨‹ã€‚è¿™ç§ç”»é¢è¿ç§»ï¼Œæˆ–è€…å¹¿ä¹‰ä¸Šçš„çŠ¶æ€è¿ç§»ï¼ˆä¾‹å¦‚ isJustClickedï¼‰ï¼Œæ˜¯ç¨‹åºä¸­è¾ƒéš¾é€‚å½“ç®¡ç†çš„å†…å®¹ä¹‹ä¸€ã€‚å½“èƒ½å¤Ÿç¼–å†™ç”»é¢è¿ç§»æ—¶ï¼Œæˆ‘è®¤ä¸ºå¯ä»¥ä½œä¸ºä¸€ååˆæ ¼çš„ç¨‹åºå‘˜è€Œè‡ªè±ªäº†ã€‚</p>
<p>å¦‚å‰æ‰€è¿°ï¼Œè™½ç„¶ç¨‹åºæœ¬èº«ä»ç„¶æœ‰å¾ˆå¤šå¯ä»¥æ”¹è¿›çš„ç©ºé—´ï¼Œä½†æ˜¯æœ¬ç« çš„åœ°é¼ æ¸¸æˆï¼Œå°†åœ¨è¿™é‡Œå‘Šä¸€æ®µè½ã€‚ä»ä¸‹æ¬¡å¼€å§‹ï¼Œæˆ‘ä»¬å°†æŒ‘æˆ˜ä¸åŒçš„äº‹ç‰©ã€‚</p>

                        </div>
                        <div class="sidetoc">
                            <nav class="pagetoc"></nav>
                        </div>
                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="13_flappy2.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="15_build.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="13_flappy2.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="15_build.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>

        <script src="ace.js"></script>
        <script src="editor.js"></script>
        <script src="mode-rust.js"></script>
        <script src="theme-dawn.js"></script>
        <script src="theme-tomorrow_night.js"></script>

        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="theme/pagetoc.js"></script>


    </div>
    </body>
</html>